define(["text!sulusalescore/components/transition-overlay/transition-overlay.html"],function(a){"use strict";var b={columns:["quantity","quantityUnit","name","account","address"],customerData:[],customerItemData:[],okButtonText:"salescore.create-transition",okCallback:null,transitionData:[]},c={MAX_CUSTOMER_LENGTH:20},d={overlayContainerClass:"transition-overlay-inner-container"},e={transitionSelect:"#transition-select",customerSelect:"#customer-select",itemsTable:"#item-table"},f="sulu.transition-overlay.",g=function(){return h.call(this,"initialized")},h=function(a){var b=f;return this.options.instanceName&&(b+="."+this.options.instanceName),b+"."+a},i=function(b){var c,e,f;this.sandbox.stop(this.sandbox.dom.find("."+d.overlayContainerClass,this.$el)),this.sandbox.dom.remove(this.sandbox.dom.find("."+d.overlayContainerClass,this.$el)),c=this.sandbox.dom.createElement('<div class="'+d.overlayContainerClass+'"></div>'),this.sandbox.dom.append(this.$el,c),f={data:b},e=this.sandbox.util.template(a,f),this.sandbox.start([{name:"overlay@husky",options:{el:c,container:this.$el,displayHeader:!1,openOnStart:!0,removeOnClose:!0,cssClass:"transition-overlay-container",instanceName:"transition",data:e,skin:"wide",okCallback:p.bind(this),okDefaultText:this.sandbox.translate(this.options.okButtonText)}}]),this.sandbox.once("husky.overlay.transition.opened",o.bind(this))},j=function(a){var b=[];for(var c in a)b.push({id:c,name:this.sandbox.translate(a[c])});return b},k=function(a){for(var b,d=this.options.customerItemData,e=[],f=-1,g=d.length;++f<g&&(b=d[f],a&&a!=b.id||(this.sandbox.util.foreach(b.items,function(a){a.account={name:l(b.name,c.MAX_CUSTOMER_LENGTH),id:b.id}}),e=e.concat(b.items),!a)););return e},l=function(a,b){var c=a;return a.length>b+2&&(c=a.substring(0,b)+".."),c},m=function(a){this.sandbox.start([{name:"item-table@sulusalescore",options:{columns:this.options.columns,data:k.call(this,a),displayToolbars:!1,calculatePrices:!1,el:e.itemsTable,hasNestedItems:!0,instanceName:"transition",showPrice:!1,showItemCount:!1}}])},n=function(a){this.customerId=a,m.call(this,a)},o=function(){var a=j.call(this,this.options.transitionData),b=this.options.customerData;this.sandbox.start([{name:"select@husky",options:{data:a,el:e.transitionSelect,instanceName:"transition",preSelectedElements:[a[0].name],style:"action big"}},{name:"select@husky",options:{data:b,defaultLabel:this.sandbox.translate("salescore.all-customers"),deselectCallback:n.bind(this),deselectField:this.sandbox.translate("salescore.all-customers"),el:e.customerSelect,instanceName:"customer",selectCallback:n.bind(this)}}]),m.call(this)},p=function(){var a,b;this.sandbox.emit("husky.select.transition.get-checked",function(b){a=b[0]}),this.sandbox.emit("sulu.item-table.transition.get-data",function(a){b=a}),this.options.okCallback&&this.options.okCallback({transition:a,items:b})};return{initialize:function(){this.customerId=null,this.options=this.sandbox.util.extend({},b,this.options),this.render(),this.sandbox.emit(g.call(this))},render:function(){i.call(this)}}});